<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Web Player</title>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>
<body>
    <h1>Spotify Web Player</h1>

    <script>
        // Callback-Funktion fÃ¼r Spotify SDK
        window.onSpotifyWebPlaybackSDKReady = () => {
            const player = new Spotify.Player({
                name: 'Spotify Web Player',
                getOAuthToken: cb => { cb(localStorage.getItem("spotifyAccessToken")); },
                volume: 0.5
            });

            // Fehlerbehandlung
            player.on('initialization_error', e => console.error('Initialization error:', e));
            player.on('authentication_error', e => console.error('Authentication error:', e));
            player.on('account_error', e => console.error('Account error:', e));
            player.on('playback_error', e => console.error('Playback error:', e));

            // Wenn der Player bereit ist
            player.on('ready', ({ device_id }) => {
                console.log('Player ist bereit. Device ID:', device_id);
                playSong(device_id, 'spotify:track:7KqDHJzHI9xFL45wBekguY');
            });

            // Player verbinden
            player.connect();

            // Funktion zum Abspielen des Songs
            function playSong(device_id, trackUri) {
                fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
                    method: 'PUT',
                    body: JSON.stringify({ uris: [trackUri] }),
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem("spotifyAccessToken")}`
                    }
                }).then(() => console.log('Playback gestartet'))
                  .catch(err => console.error('Fehler beim Abspielen:', err));
            }
        };
    </script>
</body>
</html>
